/**
 * async-http.js - Simplify async http request using only dom attributes
 * @version v0.0.16
 * @link https://github.com/raphaelcarlosr/async-http.js
 * @license ISC
 * @author Raphael Carlos Rego <raphaelcarlosr@gmail.com>
 */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=function(t,n){return void 0===n&&(n="undefined"!=typeof window?require("jquery"):require("jquery")(t)),e(n),n}:e(jQuery)}(function(e){"use strict";e.fn.attrStartWith=function(e){return[].slice.call(this.get(0).attributes).filter(function(t){return t&&t.name&&0===t.name.indexOf(e)})},Array.prototype.mergeUnique=function(e){var t=this.concat(e).sort(function(e,t){return e>t?1:e<t?-1:0});return t.filter(function(e,n){return t.indexOf(e)===n})},String.prototype.toLowerFirstLetter=function(){return this.charAt(0).toLowerCase()+this.slice(1)};var t=window.asyncHttp=function(){};t.RENDER_METHOD={prepend:0,replace:1,append:2},t.hasAsyncRequest=function(){return null!==n.currentRequest},t.cancelCurrentRequest=function(){!1!==this.hasAsyncRequest()&&n.currentRequest.cancel()},t.togglePollState=function(t){t=t instanceof jQuery?t:e(t);var n=t.data("async-poll-paused")||!1;n=!n,t.data("async-poll-paused",n),t.trigger("async:poll-pause",[n])},t.getAbsoluteUrl=function(){var e;return function(t){return e||(e=document.createElement("a")),e.href=t,e.href}}(),t.defaults={texts:{ConfirmExit:"A request is in progress, do you really want to exit and cancel the current process?"},processIndicator:void 0,renderMethod:t.RENDER_METHOD.replace,actionDone:void 0,actionTarget:void 0,pollRepeats:void 0,jsonHandler:e.noop,confirmHandler:function(t){return e.Deferred().resolve(confirm(t)).promise()}};var n={queue:[],queueRunning:!1,runQueue:function(){try{if(n.queueRunning)return;if(n.queueRunning=!0,n.currentRequest=n.queue.shift(),!n.currentRequest)return n.queueRunning=!1,void(n.currentRequest=null);n.currentRequest.request().done(function(){n.queueRunning=!1,n.currentRequest=null,n.runQueue()})}catch(e){console.error("AsyncHttp. runQueue error",e)}},currentRequest:null,getProcessIndicators:function(n,r){var a=void 0!==t.defaults.processIndicator?e(t.defaults.processIndicator):null;return r=r||".async-indicator:first",null!==a?a.add(e(r,n)):a=e(r,n),0===a.length&&(a=e(".async-indicator:first")),a.show()},processAutoLoads:function(t){var n=[];e("[data-async-autoload], [async-autoload]",t).each(function(e,t){n.push(new a(t))}),e.when.apply(e,n)},parseAction:function(t,n){for(var r=n.split(";"),a=0,o=r.length;a<o;a++){n=r[a];var s=n,i=[],u=null;if(n.indexOf(":")>=0){s=n.substr(0,n.indexOf(":")),i=e.trim(n.substr(n.indexOf(":")+1,n.length));try{window.eval.call(window,"args = ["+i+"]")}catch(e){u=[i]}}try{(t[s]||window[s]).apply(t,u)}catch(e){console.error("AsyncHttp. Invalid action exceuction from method: %s, with params %o",s,params)}}},defaultXhr:e.ajaxSettings.xhr,styleSheet:function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet.insertRule(".async-indicator{display:none;}",0),e.sheet}(),parseOption:function(r,a,o){switch(o=o||document,r){case"renderMethod":a=t.RENDER_METHOD[a];break;case"processIndicator":a=n.getProcessIndicators(o,a);break;case"target":a=e(a),0===a.length&&(a=o);break;case"poll":a=!1===isNaN(a)?1e3*parseInt(a):a.lastIndexOf("ms")==a.length-2?parseFloat(a.substr(0,a.length-2)):a.lastIndexOf("s")==a.length-1?1e3*parseFloat(a.substr(0,a.length-1)):1e3;break;case"pollRepeats":a=parseInt(a)}return a}};e('meta[name^="async:"]').each(function(r,a){a=e(a);var o=a.attr("name").replace(/async\:/gi,"").replace(/\:/gi,"."),s=a.attr("content");if(o.indexOf(".")>=0)for(var i=o.split("."),u=null,c=0,l=i.length;c<l;c++){var d=i[c];u&&(t.defaults[u][d]=s),u=d in t.defaults&&e.isPlainObject(t.defaults[d])?d:null}else o in t.defaults&&(s=n.parseOption(o,s),t.defaults[o]=s)});var r=function(r,a){var o=function(){var e=r.attrStartWith("async-");e=e.mergeUnique(r.attrStartWith("data-async-"));for(var t={},a=0,o=e.length;a<o;a++){var s=e[a],i=s.name.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()}),u=s.value;/^async/.test(i)&&(i=i.replace(/async/,"").toLowerFirstLetter()),u=n.parseOption(i,u,r),t[i]=u}return t}();if(void 0===o.processIndicator&&(o.processIndicator=n.getProcessIndicators(r)),o.isAutoLoad=void 0!==o.autoload,void 0===o.target&&(o.target=r),r.is("form")){o.type=r.attr("method");var s=r.find(':hidden[name="_method"]');0===s.length&&(s=e('<input type="hidden" name="_method"/>'),r.prepend(s)),s.val(o.type.toLowerCase()),o.data=r.serialize()}o=e.extend({},t.defaults,o,a);var i=e.extend({},e.ajaxSettings,{context:r,url:r.attr("href")||r.attr("action")||o.autoload,xhr:function(){var e=n.defaultXhr();return e instanceof window.XMLHttpRequest&&e.addEventListener("progress",this.progress,!1),e.upload&&e.upload.addEventListener("progress",this.progress,!1),e},progress:function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;r.trigger("async:onprogress",[t.toPrecision(3)])}},xhrFields:{onprogress:function(e){this.settings;if(e.lengthComputable){var t=e.loaded/e.total*100;r.trigger("async:onprogress",[t])}}},beforeSend:function(t,n){e(this).trigger("async:beforeSend",[t,n]),this.settings=n},error:function(t,n,r){e(this).trigger("async:error",[t,n,r])},success:function(t,n,r){e(this).trigger("async:success",[t,r,n])},complete:function(t,r){var a=e(this);a.trigger("async:complete",[t,r]),"undefined"!=typeof ga?ga("send","pageview",{location:this.settings.url,hitCallback:function(){a.trigger("async:ga-done",[a]),console.groupEnd(),"gaEventAction"in o&&ga("send","event",{eventCategory:o.gaEventCategory||"UnCategorized",eventAction:o.gaEventAction||"click",eventLabel:o.gaEventLabel||a.is("a")?e.trim(a.text()):"Not seted"})}}):console.groupEnd(),n.runQueue()}});return e.extend({},i,o)},a=t.request=function(o,s){void 0===o||null===o?o=e():e.isPlainObject(o)&&e.isEmptyObject(o)&&void 0!==o.url&&(s=o,o=e()),o=o instanceof jQuery?o:e(o);var i=this,u=this.config=new r(o,s||{});if(console.group("New async request for %o",u),!1===u.isAutoLoad&&!1===(o.is("a")||o.is("form")))throw new Error("The async request can't be created, the context is not valid.");o.trigger("async:start",[u]);var c=function(e){var n=u.target;switch(u.renderMethod){case t.RENDER_METHOD.append:n.append(e);break;case t.RENDER_METHOD.replace:n.html(e);break;case t.RENDER_METHOD.prepend:n.prepend(e);break;default:new Error("Undefined render method")}},l=e.Deferred(),d={done:function(t,r){c(t),void 0!==u.actionDone&&n.parseAction(e(u.actionTarget||u.target),u.actionDone),n.processAutoLoads(u.target),o.trigger("async:done",[i]),l.resolve(t,r,i)},fail:function(e,t,n){c(e.responseText),o.trigger("async:fail",[i]),l.fail(e,t,n,i)},always:function(){u.processIndicator.parent().length>0&&u.processIndicator.fadeOut(),o.trigger("async:always",[i]),l.always(i)}};if(void 0!==u.confirm){var f=/^(\{|\[)/.test(u.confirm)?JSON.parse(u.confirm):u.confirm,p=e.isArray(f)?f:[f];e.when(t.defaults.confirmHandler.apply(this,p)).done(function(t){u.target.trigger("async:confirm",[t]),i.request=t?function(){return e.ajax(u).done(d.done).fail(d.fail).always(d.always)}:function(){return e.Deferred().done(d.done).fail(d.fail).always(d.always).resolve(void 0)},n.queue.push(i),n.runQueue()})}else this.request=function(){return e.ajax(u).done(d.done).fail(d.fail).always(d.always)},n.queue.push(i),n.runQueue();return a.prototype.cancel=function(){request.abort(),this.config.target.trigger("async:aborted")},void 0!==u.poll&&o.data("async-poll-interval",setTimeout(function e(){var t=o.data("async-interval"),n=o.data("async-poll-executions")||0,r=!0===o.data("async-poll-paused");try{r?o.data("async-poll-interval",setTimeout(e,u.poll)):void 0!==u.pollRepeats&&n==u.pollRepeats?(clearTimeout(t),o.data("async-poll",void 0)):(o.data("async-poll-executions",n+1),new a(o))}catch(e){throw e}finally{o.trigger("async:poll",[n,r])}},u.poll)),l.promise()};t.isOnLine=navigator.onLine||void 0,e([window,document]).on("online offline",function(e){e.preventDefault(),e.stopPropagation(),"online"===e.type?t.isOnLine=!0:t.isOnLine=!1}),e(document).on("click","a[disabled], a.disabled",function(e){e.preventDefault(),e.stopPropagation()}),e(document).on("click","a[async]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this);if(!(n.is(":disabled")||n.hasClass("disabled")||n.parents(".disabled, [disabled]").length>0)){new a(n)}}),e(document).on("submit","form[async]",function(t){t.preventDefault(),t.stopPropagation();var n=e(this),r=e(":submit, :reset",n),o=e.fn&&e.fn.button;o&&r.button("loading"),new a(n).done(function(){o&&r.button("reset"),n.trigger("async:submit-done")})}),e(document).ready(function(){n.processAutoLoads(document.body)}),e(window).on("beforeunload",function(e){if(t.hasAsyncRequest())return t.defaults.texts.ConfirmExit}),e.fn.__load=e.fn.load,e.fn.load=function(t,n,r){var o=e(this);o.attr("async-autoload",t),new a(o).done(function(t){(r||e.noop)(t),o.trigger("async:load-done",[t])})}});